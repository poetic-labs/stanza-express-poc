const fs = require('fs');

function run(keyword) {
  const path = process.cwd();

	try {
    return searchForPath(process.cwd(), keyword);
	}
  catch(err) {
    console.log(`no package.json exists with keyword: ${keyword}`)
		return false;
  }
}

function searchForPath(path, keyword) {
  const files = fs.readdirSync(path);
  if(isPackageJson(files) && hasKeyword(keyword, getPackageJson(path)) && path.indexOf("node_modules") === -1){
		return path;
	} else {
		return searchForPath(popLastDir(path), keyword);
	}
}

function hasKeyword(keyword, json) {
	return !!json.keywords ? json.keywords.indexOf(keyword) > -1 : false;
}

function popLastDir(path) {
  return path.substring(0, path.lastIndexOf('/'))
}

function isPackageJson(files) {
	return files.indexOf('package.json') > -1;
}

function getPackageJson(path) {
	return JSON.parse(fs.readFileSync(`${path}/package.json`, "utf8"));
}

module.exports = run;
